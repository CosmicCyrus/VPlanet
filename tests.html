
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Writing Tests and Examples &#8212; VPLanet 2.3.38
 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Attribution" href="attr.html" />
    <link rel="prev" title="VPLanet Contributors Guide" href="StyleGuide.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="writing-tests-and-examples">
<h1>Writing Tests and Examples<a class="headerlink" href="#writing-tests-and-examples" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#unit-tests" id="id1">Unit Tests</a></p></li>
<li><p><a class="reference internal" href="#writing-examples" id="id2">Writing Examples</a></p></li>
</ul>
</nav>
<section id="unit-tests">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Unit Tests</a><a class="headerlink" href="#unit-tests" title="Permalink to this heading">¶</a></h2>
<p>VPLanet includes “unit tests” to maintain code results as the project grows.
These tests are short versions of the examples that run in a few seconds, which
is sufficient time to ensure that integration is accurate. Unit tests are also
used to track the amount of the code that is executed over the sum of all tests,
further enabling confidence in the code’s accuracy.</p>
<p>Test scripts live in the <code class="code docutils literal notranslate"><span class="pre">tests/</span></code> directory in the top-level repo folder.
Tests are executed automatically on Travis using <code class="code docutils literal notranslate"><span class="pre">py.test</span></code>, which will
find all Python files with the word <code class="code docutils literal notranslate"><span class="pre">test</span></code> somewhere in their name (side note:
if it’s not meant to be a test, don’t put <code class="code docutils literal notranslate"><span class="pre">test</span></code> in the file name!).
The <code class="code docutils literal notranslate"><span class="pre">py.test</span></code> suite specifically checks for cases where an <code class="code docutils literal notranslate"><span class="pre">AssertionError</span></code>
is raised, so in your tests you should use <code class="code docutils literal notranslate"><span class="pre">assert</span></code> statements to check whether
the output is equal to (or very close to) a benchmarked value.</p>
<p>To write a test, create a directory in <code class="code docutils literal notranslate"><span class="pre">tests/</span></code> with a descriptive name
(such as the modules it’s meant to test or a specific application of the code).
Include the <code class="code docutils literal notranslate"><span class="pre">.in</span></code> files needed to run the test and create a Python
file <code class="code docutils literal notranslate"><span class="pre">test_&lt;TEST_NAME&gt;.py</span></code>. This file should follow this basic structure:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">vplanet</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pathlib</span>

<span class="c1"># Path to this directory</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">test_something</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Brief description of what we&#39;re testing.&quot;&quot;&quot;</span>
    <span class="c1"># Run vplanet</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">vplanet</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="s2">&quot;vpl.in&quot;</span><span class="p">)</span>

    <span class="c1"># Run our comparisons</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">planet</span><span class="o">.</span><span class="n">Eccentricity</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">TotEnergy</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">initial</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">TotEnergy</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">star</span><span class="o">.</span><span class="n">Luminosity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0672752</span> <span class="p">,</span> <span class="mf">0.0672752</span> <span class="p">,</span> <span class="mf">0.0080845</span><span class="o">...</span><span class="p">]))</span>
</pre></div>
</div>
<p>In the example above, we’re checking three things: that the final planet
eccentricity (from the log file) is zero; that the final system energy
(from the log file) is equal to the initial system energy; and that
the star’s luminosity (from the forward file) is equal to some array of
values.</p>
<p>These unit tests not only ensure new modification don’t break parts of the code
that already work. In addition, they are used to compute the fraction of the code
that is verified with <cite>CodeCov &lt;https://app.codecov.io/gh/VirtualPlanetaryLaboratory/vplanet&gt;</cite>
Thus, to approach (and someday maintain) 100% verification requires all new
features to include a unit test. Finally, unit tests are valuable for ensuring
that no memory issues are present through periodic valgrind tests.</p>
</section>
<section id="writing-examples">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Writing Examples</a><a class="headerlink" href="#writing-examples" title="Permalink to this heading">¶</a></h2>
<p>Examples live in the <code class="code docutils literal notranslate"><span class="pre">examples/</span></code> directory in the top-level repo folder, and,
just like tests, there should be one aptly-named folder per example. Include
the input files needed to run the example and a <code class="code docutils literal notranslate"><span class="pre">README.rst</span></code> file that
describes the example and its expected output in detail:</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="gh">Example name</span>
<span class="gh">============</span>

<span class="gh">Overview</span>
<span class="gh">--------</span>

===================   ============
<span class="gs">**Date**</span>              MM/DD/YY
<span class="gs">**Author**</span>            AUTHOR_NAME
<span class="gs">**Modules**</span>           <span class="s">`MODULE1_NAME </span><span class="si">&lt;../src/MODULE1_NAME.html&gt;</span><span class="s">`_</span>
                      <span class="s">`MODULE2_NAME </span><span class="si">&lt;../src/MODULE2_NAME.html&gt;</span><span class="s">`_</span>
<span class="gs">**Approx. runtime**</span>   RUNTIME_IN_SECONDS
<span class="gs">**Source code**</span>       <span class="s">`GitHub </span><span class="si">&lt;https://github.com/VirtualPlanetaryLaboratory/vplanet-private/tree/master/examples/EXAMPLE_DIR_NAME&gt;</span><span class="s">`_</span>
===================   ============

DETAILED DESCRIPTION OF THE EXAMPLE

<span class="gh">To run this example</span>
<span class="gh">-------------------</span>

EXACT INSTRUCTIONS TO REPRODUCE EXAMPLE

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">bash</span>

    python<span class="w"> </span>makeplot.py


<span class="gh">Expected output</span>
<span class="gh">---------------</span>

FIGURES SHOWCASING THE EXAMPLE OUTPUT

<span class="p">..</span> <span class="ow">figure</span><span class="p">::</span> UNIQUE_FIGURE_NAME.png
   <span class="nc">:width:</span> 600px
   <span class="nc">:align:</span> center

   FIGURE CAPTION
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">note<span class="colon">:</span></dt>
<dd class="field-odd"><p>All example figures are generated by the same command: python makplot.py.</p>
</dd>
</dl>
<p>When creating an example, run it to figure out the approximate
runtime (see above) and create <strong>low resolution PNG images</strong> (no more
than about 800x800 pixels) with <strong>unique file names</strong> (so they don’t
overwrite images from other examples when building the docs) in the
example directory. To commit these images, you’ll need to <strong>force add them</strong>
since <code class="code docutils literal notranslate"><span class="pre">png</span></code> files are in the <cite>.gitignore</cite> by default:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>add<span class="w"> </span>-f<span class="w"> </span>UNIQUE_FIGURE_NAME.png
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">VPLanet</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing VPLanet</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="help.html">Options and Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="src.html">C API</a></li>
<li class="toctree-l1"><a class="reference internal" href="vplot.html">VPLOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="parametersweep.html">Parameter Sweep Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference external" href="http://faculty.washington.edu/rkb9/vplanet/Workshop21/">Workshop Lectures</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="developers.html">Contributor’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="repos.html">Other VPLanet Repositories</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/VirtualPlanetaryLaboratory/vplanet">GitHub</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="developers.html">Contributor’s Guide</a><ul>
      <li>Previous: <a href="StyleGuide.html" title="previous chapter">VPLanet Contributors Guide</a></li>
      <li>Next: <a href="attr.html" title="next chapter">Attribution</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, The VPLanet Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.1.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/tests.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>